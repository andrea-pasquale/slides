import { Awaitable } from '@antfu/utils';
import * as Shiki from 'shiki';
import { IThemeRegistration, ILanguageRegistration, Highlighter } from 'shiki';
import * as monaco from 'monaco-editor';
import { App, Ref } from 'vue';
import { Router } from 'vue-router';
import mermaid from 'mermaid';
import { KatexOptions } from 'katex';
import { WindiCssOptions } from 'vite-plugin-windicss';

interface SlidevConfig {
    title: string;
    /**
     * String template to compose title
     *
     * @example "%s - Slidev" - to suffix " - Slidev" to all pages
     * @defult '%s'
     */
    titleTemplate: string;
    /**
     * @see https://sli.dev/themes/use.html
     * @defult 'default'
     */
    theme: string;
    /**
     * @defult true
     */
    remoteAssets: boolean | 'dev' | 'build';
    /**
     * Enable Monaco
     *
     * @see https://sli.dev/custom/config-monaco.html
     * @defult 'dev'
     */
    monaco: boolean | 'dev' | 'build';
    /**
     * Show a download button in the SPA build,
     * could also be a link to custom pdf
     *
     * @default true
     */
    download: boolean | string;
    /**
     * Information shows on the built SPA
     * Can be a markdown string
     *
     * @default true
     */
    info: string | boolean;
    /**
     * Prefer highlighter
     *
     * @see https://sli.dev/custom/highlighters.html
     * @default prism
     */
    highlighter: 'prism' | 'shiki';
    /**
     * Show line numbers in code blocks
     *
     * @default false
     */
    lineNumbers: boolean;
    /**
     * Force slides color schema
     *
     * @default 'auto'
     */
    colorSchema: 'dark' | 'light' | 'all' | 'auto';
    /**
     * Router mode for vue-router
     *
     * @default 'hash'
     */
    routerMode: 'hash' | 'history';
    /**
     * Aspect ratio for slides
     * should be like `16/9` or `1:1`
     *
     * @default '16/9'
     */
    aspectRatio: number;
    /**
     * The actual width fro slides canvas.
     * unit in px.
     *
     * @default '980'
     */
    canvasWidth: number;
    /**
     * Controls whether texts in slides are selectable
     *
     * @default false
     */
    selectable: boolean;
    /**
     * Configure for themes, will inject intro root styles as
     * `--slidev-theme-x` for attribute `x`
     *
     * This allows themes to have customization options in frontmatter
     * Refer to themes' document for options avaliable
     *
     * @default {}
     */
    themeConfig: SlidevThemeConfig;
    /**
     * Configure fonts for the slides and app
     *
     * @default {}
     */
    fonts: ResolvedFontOptions;
}
declare type FontOptions = {
    /**
     * Sans serif fonts (default fonts for most text)
     */
    sans?: string | string[];
    /**
     * Serif fonts
     */
    serif?: string | string[];
    /**
     * Monospace fonts, for code blocks and etc.
     */
    mono?: string | string[];
    /**
     * Load webfonts for custom CSS (does not apply anywhere by default)
     */
    custom?: string | string[];
    /**
     * Weights for fonts
     *
     * @default [200, 400, 600]
     */
    weights?: string | (string | number)[];
    /**
     * Import italic fonts
     *
     * @default false
     */
    italic?: boolean;
    /**
     * @default 'google'
     */
    provider?: 'none' | 'google';
    /**
     * Specify web fonts names, will detect from `sans`, `mono`, `serif` if not provided
     */
    webfonts?: string[];
    /**
     * Specify local fonts names, be excluded from webfonts
     */
    local?: string[];
    /**
     * Use fonts fallback
     *
     * @default true
     */
    fallbacks?: boolean;
};

interface SlideInfoBase {
    raw: string;
    content: string;
    note?: string;
    frontmatter: Record<string, any>;
    title?: string;
}
interface SlideInfo extends SlideInfoBase {
    index: number;
    start: number;
    end: number;
    inline?: SlideInfoBase;
    source?: SlideInfoWithPath;
}
interface SlideInfoWithPath extends SlideInfoBase {
    filepath: string;
}
interface SlideInfoExtended extends SlideInfo {
    notesHTML: string;
}
/**
 * Metadata for "slidev" field in themes' package.json
 */
interface SlidevThemeMeta {
    defaults?: Partial<SlidevConfig>;
    colorSchema?: 'dark' | 'light' | 'both';
    highlighter?: 'prism' | 'shiki' | 'both';
}
declare type SlidevThemeConfig = Record<string, string | number>;
declare type ResolvedFontOptions = {
    sans: string[];
    mono: string[];
    serif: string[];
    weights: string[];
    italic: boolean;
    provider: 'none' | 'google';
    webfonts: string[];
    local: string[];
};
interface SlidevFeatureFlags {
    katex: boolean;
    monaco: boolean;
    tweet: boolean;
    mermaid: boolean;
}
interface SlidevMarkdown {
    slides: SlideInfo[];
    raw: string;
    config: SlidevConfig;
    features: SlidevFeatureFlags;
    headmatter: Record<string, unknown>;
    filepath?: string;
    entries?: string[];
    themeMeta?: SlidevThemeMeta;
}

interface AppContext {
    app: App;
    router: Router;
}
interface ShikiDarkModeThemes {
    dark: IThemeRegistration;
    light: IThemeRegistration;
}
interface ShikiOptions {
    theme?: IThemeRegistration | ShikiDarkModeThemes;
    langs?: ILanguageRegistration[];
    highlighter?: Highlighter;
}
interface MonacoSetupReturn {
    theme?: {
        light?: string;
        dark?: string;
    };
}
declare type MermaidOptions = (typeof mermaid.initialize) extends (a: infer A) => any ? A : never;
interface NavOperations {
    next: () => void;
    prev: () => Promise<void>;
    nextSlide: () => void;
    prevSlide: () => Promise<void>;
    downloadPDF: () => Promise<void>;
    toggleDark: () => void;
    toggleOverview: () => void;
    escapeOverview: () => void;
    showGotoDialog: () => void;
}
interface ShortcutOptions {
    key: string | Ref<boolean>;
    fn?: () => void;
    autoRepeat?: boolean;
}
declare type ShikiSetup = (shiki: typeof Shiki) => Awaitable<ShikiOptions | undefined>;
declare type KatexSetup = () => Awaitable<Partial<KatexOptions> | undefined>;
declare type WindiSetup = () => Awaitable<Partial<WindiCssOptions> | undefined>;
declare type MonacoSetup = (m: typeof monaco) => Awaitable<MonacoSetupReturn>;
declare type AppSetup = (context: AppContext) => Awaitable<void>;
declare type MermaidSetup = () => Partial<MermaidOptions> | undefined;
declare type ShortcutsSetup = (nav: NavOperations) => Array<ShortcutOptions>;
declare function defineShikiSetup(fn: ShikiSetup): ShikiSetup;
declare function defineWindiSetup(fn: WindiSetup): WindiSetup;
declare function defineMonacoSetup(fn: MonacoSetup): MonacoSetup;
declare function defineAppSetup(fn: AppSetup): AppSetup;
declare function defineMermaidSetup(fn: MermaidSetup): MermaidSetup;
declare function defineKatexSetup(fn: KatexSetup): KatexSetup;
declare function defineShortcutsSetup(fn: ShortcutsSetup): ShortcutsSetup;

export { AppContext, AppSetup, FontOptions, KatexSetup, MermaidOptions, MermaidSetup, MonacoSetup, MonacoSetupReturn, NavOperations, ResolvedFontOptions, ShikiDarkModeThemes, ShikiOptions, ShikiSetup, ShortcutOptions, ShortcutsSetup, SlideInfo, SlideInfoBase, SlideInfoExtended, SlideInfoWithPath, SlidevConfig, SlidevFeatureFlags, SlidevMarkdown, SlidevThemeConfig, SlidevThemeMeta, WindiSetup, defineAppSetup, defineKatexSetup, defineMermaidSetup, defineMonacoSetup, defineShikiSetup, defineShortcutsSetup, defineWindiSetup };
